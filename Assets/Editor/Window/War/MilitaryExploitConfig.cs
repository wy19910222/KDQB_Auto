/*
 * @Author: wangyun
 * @CreateTime: 2023-11-20 18:37:42 092
 * @LastEditor: wangyun
 * @EditTime: 2023-11-20 18:37:42 100
 */

using System;
using UnityEditor;
using UnityEngine;

public class MilitaryExploitConfig : PrefsEditorWindow<MilitaryExploit> {
	[MenuItem("Tools_Window/War/MilitaryExploit")]
	private static void Open() {
		GetWindow<MilitaryExploitConfig>("刷军功").Show();
	}

	private EditorCoroutine m_Co;
	
	private void OnGUI() {
		DrawVector2IntField(EditorGUIUtility.TrTempContent("目标建筑屏幕坐标"), MilitaryExploit.TARGET_POS, pos => MilitaryExploit.TARGET_POS = pos);
		DrawVector2IntField(EditorGUIUtility.TrTempContent("攻击按钮屏幕坐标"), MilitaryExploit.ATTACK_BTN_POS, pos => MilitaryExploit.ATTACK_BTN_POS = pos);
		GUILayout.Space(5F);
		if (MilitaryExploit.IsRunning) {
			if (GUILayout.Button("关闭")) {
				IsRunning = false;
			}
		} else {
			if (GUILayout.Button("开启")) {
				IsRunning = true;
			}
		}
	}

	private void DrawVector2IntField(GUIContent label, Vector2Int pos, Action<Vector2Int> callback) {
		if (callback != null) {
			EditorGUILayout.BeginHorizontal();
			GUILayout.Space(((GUIStyle) "Label").CalcSize(label).x + 10F);
			if (GUILayout.Button("屏幕点选", GUILayout.Width(80F))) {
				if (m_Co != null) {
					this.StopCoroutine(m_Co);
				}
				m_Co = this.Wait(() => {
					callback(Operation.GetMousePos());
					return MouseUtils.IsLeftDown();
				}, () => {
					m_Co = null;
				});
			}
			EditorGUILayout.EndHorizontal();
			GUILayout.Space(-EditorGUIUtility.singleLineHeight - 3F);
			callback(EditorGUILayout.Vector2IntField(label, pos));
		}
	}
	
	private void Update() {
		Repaint();
	}
}