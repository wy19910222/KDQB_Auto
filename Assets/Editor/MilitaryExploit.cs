/*
 * @Author: wangyun
 * @CreateTime: 2023-11-20 18:37:42 092
 * @LastEditor: wangyun
 * @EditTime: 2023-11-20 18:37:42 100
 */

using System;
using System.Collections;
using UnityEditor;
using UnityEngine;

public class MilitaryExploitConfig : PrefsEditorWindow<MilitaryExploit> {
	[MenuItem("Window/War/MilitaryExploit")]
	private static void Open() {
		GetWindow<MilitaryExploitConfig>("刷军功").Show();
	}
	
	private void OnGUI() {
		if (MilitaryExploit.IsRunning) {
			if (GUILayout.Button("关闭")) {
				IsRunning = false;
			}
		} else {
			if (GUILayout.Button("开启")) {
				IsRunning = true;
			}
		}
	}

	private void OnBecameVisible() {
		EditorApplication.update += Repaint;
	}

	private void OnBecameInvisible() {
		EditorApplication.update -= Repaint;
	}
}

public enum VKCode {
	Q = 81,
	W = 87,
	E = 69,
	R = 82,
	F1 = 112,
	F2 = 113,
	F3 = 114,
	F4 = 115,
}

public class MilitaryExploit {
	public static bool IsRunning;

	[MenuItem("Assets/StartMilitaryExploit", priority = -1)]
	private static void Enable() {
		Disable();
		Debug.Log($"刷军功键盘点击已开启");
		IsRunning = true;
		KeyboardUtils.OnKeyUp = OnKeyUp;
		KeyboardUtils.Hook();
	}

	[MenuItem("Assets/StopMilitaryExploit", priority = -1)]
	private static void Disable() {
		if (IsRunning) {
			KeyboardUtils.Unhook();
			IsRunning = false;
			Debug.Log("刷军功键盘点击已关闭");
		}
	}

	private static void OnKeyUp(int vkCode) {
		switch ((VKCode) vkCode) {
			case VKCode.F1: {
				EditorCoroutineManager.StartCoroutine(OnF1());
				break;
			}
			case VKCode.F2: {
				EditorCoroutineManager.StartCoroutine(OnF2());
				break;
			}
			case VKCode.F3: {
				break;
			}
			case VKCode.F4: {
				break;
			}
		}
	}
	private static IEnumerator OnF1() {
		switch (Recognize.CurrentScene) {
			case Recognize.Scene.OUTSIDE:
				Operation.Click(722, 427);	// 选中目标电站（每次使用前需调整坐标）
				yield return new EditorWaitForSeconds(0.1F);
				Operation.Click(946, 747);	// 攻击按钮（每次使用前需调整坐标）
				yield return new EditorWaitForSeconds(0.2F);
				Operation.Click(1210, 820);	// 一键上阵按钮
				break;
			case Recognize.Scene.FIGHTING:
				yield return null;
				Operation.Click(960, 460);	// 出征按钮
				break;
		}
	}

	private static IEnumerator OnF2() {
		switch (Recognize.CurrentScene) {
			case Recognize.Scene.OUTSIDE:
				Operation.Click(722, 427);	// 选中目标电站（每次使用前需调整坐标）
				yield return new EditorWaitForSeconds(0.1F);
				Operation.Click(946, 747);	// 攻击按钮（每次使用前需调整坐标）
				break;
			case Recognize.Scene.FIGHTING:
				yield return null;
				Operation.Click(960, 460);	// 出征按钮
				break;
		}
	}
}
